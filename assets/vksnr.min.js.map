{"version":3,"file":"vksnr.min.js","sources":["vksnr.ts"],"sourcesContent":["import type apiFetch from '@wordpress/api-fetch';\n\ndeclare global {\n\tinterface wp { // NOSONAR\n\t\tapiFetch: typeof apiFetch;\n\t}\n\n\tinterface Window {\n\t\twp: wp;\n\t}\n}\n\ninterface ErrorResponse {\n\tcode: string;\n\tmessage: string;\n}\n\ninterface ApiResponse {\n\tid: string;\n\ttype: string;\n}\n\ndeclare const wp: wp;\n\nconst typeMap = new Map<string, string>([\n\t['user', 'id'],\n\t['group', 'club'],\n\t['application', 'app'],\n]);\n\nconst callback = () => {\n\tconst src = document.getElementById('vk-screen-name') as HTMLInputElement | null;\n\tconst dst = document.getElementById('vk-screen-name-result') as HTMLInputElement | null;\n\tconst btn = document.getElementById('vk-screen-name-resolve') as HTMLInputElement | null;\n\n\tif (src && dst && btn) {\n\t\tbtn.addEventListener('click', () => {\n\t\t\tif (!btn.hasAttribute('aria-disabled')) {\n\t\t\t\tconst name = src.value.replace(/^(https?:\\/\\/(m|new\\.)?vk\\.com)?\\/?/iu, '');\n\t\t\t\tdst.value  = '';\n\t\t\t\tbtn.setAttribute('aria-disabled', 'true');\n\n\t\t\t\twp.apiFetch<ApiResponse|ErrorResponse>({ path: `vksnr/v1/resolve/${name}` })\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif ('message' in r) {\n\t\t\t\t\t\t\tdst.value = r.message;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst { id, type } = r;\n\t\t\t\t\t\t\tdst.value = 'https://vk.com/' + (typeMap.get(type) || '') + id;\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch((e: Error | ErrorResponse) => {\n\t\t\t\t\t\tdst.value = e.message;\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => btn.removeAttribute('aria-disabled'))\n\t\t\t}\n\t\t});\n\t}\n};\n\ndocument.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', callback) : callback();\n"],"names":["typeMap","Map","callback","src","document","getElementById","dst","btn","addEventListener","hasAttribute","name","value","replace","setAttribute","wp","apiFetch","path","then","r","message","id","type","get","catch","e","removeAttribute","readyState"],"mappings":"YAwBA,MAAMA,EAAU,IAAIC,IAAoB,CACvC,CAAC,OAAQ,MACT,CAAC,QAAS,QACV,CAAC,cAAe,SAGXC,EAAW,WACVC,EAAMC,SAASC,eAAe,kBAC9BC,EAAMF,SAASC,eAAe,yBAC9BE,EAAMH,SAASC,eAAe,0BAEhCF,GAAOG,GAAOC,GACjBA,EAAIC,iBAAiB,SAAS,SACxBD,EAAIE,aAAa,iBAAkB,OACjCC,EAAOP,EAAIQ,MAAMC,QAAQ,wCAAyC,IACxEN,EAAIK,MAAS,GACbJ,EAAIM,aAAa,gBAAiB,QAElCC,GAAGC,SAAoC,CAAEC,KAAO,oBAAmBN,MACjEO,MAAMC,OACF,YAAaA,EAChBZ,EAAIK,MAAQO,EAAEC,YACR,OACAC,GAAEA,EAAFC,KAAMA,GAASH,EACrBZ,EAAIK,MAAQ,mBAAqBX,EAAQsB,IAAID,IAAS,IAAMD,MAE3DG,OAAOC,IACTlB,EAAIK,MAAQa,EAAEL,WAEdF,MAAK,IAAMV,EAAIkB,gBAAgB,wBAMb,YAAxBrB,SAASsB,WAA2BtB,SAASI,iBAAiB,mBAAoBN,GAAYA"}