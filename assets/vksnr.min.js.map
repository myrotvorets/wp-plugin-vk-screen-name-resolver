{"version":3,"file":"vksnr.min.js","sources":["vksnr.ts"],"sourcesContent":["import type apiFetch from '@wordpress/api-fetch';\n\ndeclare global {\n\tinterface wp { // NOSONAR\n\t\tapiFetch: typeof apiFetch;\n\t}\n\n\tinterface Window {\n\t\twp: wp;\n\t}\n}\n\ninterface ErrorResponse {\n\tcode: string;\n\tmessage: string;\n}\n\ninterface ApiResponse {\n\tid: string;\n\ttype: string;\n}\n\ndeclare const wp: wp;\n\nconst typeMap = new Map<string, string>( [\n\t[ 'user', 'id' ],\n\t[ 'group', 'club' ],\n\t[ 'application', 'app' ],\n] );\n\nconst callback = (): void => {\n\tconst src = document.getElementById( 'vk-screen-name' ) as HTMLInputElement | null;\n\tconst dst = document.getElementById( 'vk-screen-name-result' ) as HTMLInputElement | null;\n\tconst btn = document.getElementById( 'vk-screen-name-resolve' ) as HTMLInputElement | null;\n\n\tif ( src && dst && btn ) {\n\t\tbtn.addEventListener( 'click', () => {\n\t\t\tif ( ! btn.hasAttribute( 'aria-disabled' ) ) {\n\t\t\t\tconst name = src.value.replace( /^(https?:\\/\\/(m|new\\.)?vk\\.com)?\\/?/iu, '' );\n\t\t\t\tdst.value = '';\n\t\t\t\tbtn.setAttribute( 'aria-disabled', 'true' );\n\n\t\t\t\tvoid wp.apiFetch<ApiResponse|ErrorResponse>( { path: `vksnr/v1/resolve/${ name }` } )\n\t\t\t\t\t.then( ( r ) => {\n\t\t\t\t\t\tif ( 'message' in r ) {\n\t\t\t\t\t\t\tdst.value = r.message;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst { id, type } = r;\n\t\t\t\t\t\t\tdst.value = `https://vk.com/${ typeMap.get( type ) || '' }${ id }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} ).catch( ( e: Error | ErrorResponse ) => {\n\t\t\t\t\t\tdst.value = e.message;\n\t\t\t\t\t} )\n\t\t\t\t\t.then( () => btn.removeAttribute( 'aria-disabled' ) );\n\t\t\t}\n\t\t} );\n\t}\n};\n\nif ( document.readyState === 'loading' ) {\n\tdocument.addEventListener( 'DOMContentLoaded', callback );\n} else {\n\tcallback();\n}\n"],"names":["typeMap","Map","callback","src","document","getElementById","dst","btn","addEventListener","hasAttribute","name","value","replace","setAttribute","wp","apiFetch","path","then","r","message","id","type","get","catch","e","removeAttribute","readyState"],"mappings":"YAwBA,MAAMA,EAAU,IAAIC,IAAqB,CACxC,CAAE,OAAQ,MACV,CAAE,QAAS,QACX,CAAE,cAAe,SAGZC,EAAW,KAChB,MAAMC,EAAMC,SAASC,eAAgB,kBAC/BC,EAAMF,SAASC,eAAgB,yBAC/BE,EAAMH,SAASC,eAAgB,0BAEhCF,GAAOG,GAAOC,GAClBA,EAAIC,iBAAkB,SAAS,KAC9B,IAAOD,EAAIE,aAAc,iBAAoB,CAC5C,MAAMC,EAAOP,EAAIQ,MAAMC,QAAS,wCAAyC,IACzEN,EAAIK,MAAQ,GACZJ,EAAIM,aAAc,gBAAiB,QAE9BC,GAAGC,SAAqC,CAAEC,KAAO,oBAAoBN,MACxEO,MAAQC,IACR,GAAK,YAAaA,EACjBZ,EAAIK,MAAQO,EAAEC,YACR,CACN,MAAMC,GAAEA,EAAFC,KAAMA,GAASH,EACrBZ,EAAIK,MAAS,kBAAkBX,EAAQsB,IAAKD,IAAU,KAAOD,QAE3DG,OAASC,IACZlB,EAAIK,MAAQa,EAAEL,WAEdF,MAAM,IAAMV,EAAIkB,gBAAiB,wBAMV,YAAxBrB,SAASsB,WACbtB,SAASI,iBAAkB,mBAAoBN,GAE/CA"}